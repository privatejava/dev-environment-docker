# AI Context & Memory File
## Dev Environment Docker Project

This file helps AI assistants understand the project context and resume conversations seamlessly.

---

## Project Overview

This is a **comprehensive development environment Docker image** designed to be a ready-to-use coding environment for both Node.js and Python projects. The container defaults to **interactive bash mode** for immediate development work.

**Key Philosophy**: The container is optimized for development productivity - everything is pre-installed and configured so you can start coding immediately without setup.

---

## Project Structure

```
dev-environment/
├── Dockerfile              # Main Docker image definition
├── docker-entrypoint.sh   # Entrypoint script (handles bash/SSH modes)
├── Makefile               # Convenient build/run commands
├── build.sh               # Advanced build script with options
├── .dockerignore          # Files to exclude from build context
├── README.md              # User documentation
└── .ai-context.md         # This file - AI memory/context
```

---

## Key Features & Decisions

### 1. **Default Behavior: Interactive Bash**
- **Decision**: Container defaults to interactive bash as `devuser` (not SSH daemon)
- **Rationale**: Most developers want immediate access, not SSH setup
- **Implementation**: Entrypoint script handles this automatically
- **Usage**: `docker run -it --rm dev-environment:latest` or `make run`

### 2. **Comprehensive Development Tools**
- **Node.js 18** via nvm (with yarn, pnpm, TypeScript, ESLint, Prettier, Jest)
- **Python 3.11** with pip, virtualenv, pipenv, poetry, pytest, black, flake8, mypy
- **Build tools**: gcc, g++, make, cmake (for native modules)
- **Version control**: git, git-lfs
- **Editors**: vim, nano
- **Utilities**: curl, wget, jq, tree, htop, tmux, screen
- **Debugging**: strace, tcpdump, netcat

### 3. **Security & User Management**
- **Non-root user**: `devuser` (created in Dockerfile)
- **Sudo access**: Passwordless sudo for convenience in dev environment
- **SSH**: Configured but disabled by default (use `sshd` argument to enable)

### 4. **Cursor CLI Integration**
- **Location**: Separate RUN command (lines 117-132 in Dockerfile)
- **Purpose**: Easy to update independently
- **Installation**: Tries npm package first, falls back to install scripts
- **Note**: This section can be updated without rebuilding other layers

### 5. **Optimization Strategy**
- **Minimal layers**: Combined RUN commands where possible
- **Smaller size**: `--no-install-recommends`, cleanup apt cache
- **Better caching**: Logical grouping for optimal layer caching
- **Separate RUN for Cursor CLI**: Allows independent updates

---

## Configuration Details

### Environment Variables (Dockerfile)
- `SSH_PORT=22` - SSH port (exposed)
- `USERNAME=devuser` - Default user name

### Makefile Variables
- `IMAGE_NAME=dev-environment` - Default image name
- `IMAGE_TAG=latest` - Default tag
- `CONTAINER_USER=devuser` - Container username (NOT host USERNAME to avoid conflicts)

### User Setup
- **Username**: `devuser`
- **Home directory**: `/home/devuser`
- **Workspace directories**: `~/workspace`, `~/projects` (auto-created)
- **Shell**: bash with enhanced aliases and completion
- **Auto-navigation**: Changes to workspace/projects on login

---

## Usage Patterns

### Most Common Commands
```bash
# Build the image
make build

# Run interactively (DEFAULT - most common)
make run
# or
docker run -it --rm dev-environment:latest

# Run with SSH daemon (if needed)
make run-sshd PORT=2222
```

### Development Workflow
1. Build once: `make build`
2. Run interactively: `make run`
3. Start coding immediately - all tools are ready
4. Type `exit` when done - container auto-removes

---

## Important Context from Development

### Conversation History Highlights

1. **Initial Request**: Create optimized Dockerfile for dev environment
2. **Added Node.js 18**: Via nvm for easy version management
3. **Added Python tools**: Comprehensive Python development stack
4. **Added Cursor CLI**: In separate RUN for easy updates
5. **Interactive Bash Default**: Changed from SSH daemon to interactive bash
6. **Entrypoint Script**: Created to handle both bash and SSH modes
7. **Makefile Fixes**: Fixed USERNAME conflict (host vs container)

### Key Technical Decisions

- **Base Image**: `python:3.11-slim-bullseye` (Debian-based, includes Python)
- **Node.js Installation**: nvm (not direct install) for flexibility
- **Package Managers**: Multiple options (npm, yarn, pnpm for Node; pip, pipenv, poetry for Python)
- **Default Mode**: Interactive bash (not SSH) for better developer experience
- **Entrypoint Pattern**: Script-based entrypoint for flexibility

### Known Issues & Solutions

1. **USERNAME Conflict**: Host USERNAME env var conflicted with container user
   - **Solution**: Use `CONTAINER_USER` in Makefile instead of `USERNAME`
   
2. **Container Auto-Close**: User wanted interactive bash instead of SSH daemon
   - **Solution**: Created entrypoint script with bash as default

---

## File-Specific Notes

### Dockerfile Structure
1. **Lines 8-75**: System packages and SSH setup (root user)
2. **Lines 77-115**: nvm, Node.js 18, Node.js tools (devuser)
3. **Lines 117-132**: Cursor CLI installation (separate RUN - easy to update)
4. **Lines 133-135**: Python development tools (devuser)
5. **Lines 137-141**: Git configuration (devuser)
6. **Lines 143-195**: Shell aliases and enhancements (devuser)
7. **Lines 197-211**: Entrypoint setup and CMD (root)

### Entrypoint Script (`docker-entrypoint.sh`)
- **Default**: Interactive bash as devuser
- **SSH Mode**: Pass `sshd` or `ssh` argument
- **Custom Commands**: Can execute any command passed

### Makefile Targets
- `make build` - Build image
- `make run` - Interactive bash (DEFAULT)
- `make run-sshd` - SSH daemon mode
- `make bash` - Same as `make run`
- `make bash-root` - Interactive bash as root
- `make shell` - Shell in running container (requires SSH mode)

---

## Future Enhancement Ideas

1. **Volume Mounts**: Consider adding common volume mount patterns
2. **Environment Variables**: Document common env vars for projects
3. **Docker Compose**: Could add docker-compose.yml for multi-container setups
4. **Health Checks**: Could add health check for SSH mode
5. **Version Pinning**: Consider pinning specific versions of tools

---

## Quick Reference

### Build & Run
```bash
make build && make run
```

### Update Cursor CLI
Edit Dockerfile lines 117-132, then rebuild

### Change Default User
Update `USERNAME` env var in Dockerfile and `CONTAINER_USER` in Makefile

### Add New Tool
- System package: Add to apt-get install list (line 10-61)
- Node.js package: Add to npm install -g list (line 90-100)
- Python package: Add to pip install list (line 119-131)

---

## AI Assistant Notes

When helping with this project:
- **Default behavior is interactive bash** - not SSH
- **User is `devuser`** - not root (unless explicitly requested)
- **Optimization matters** - keep layers minimal, cache-friendly
- **Separate RUN for Cursor CLI** - allows independent updates
- **Makefile uses `CONTAINER_USER`** - not `USERNAME` (to avoid host conflicts)
- **Entrypoint script** handles mode switching (bash vs sshd)

Common tasks:
- Adding new development tools
- Updating versions (Node.js, Python, packages)
- Optimizing Dockerfile layers
- Fixing build issues
- Adding new Makefile targets

---

## Last Updated
- Date: Current session
- Major Changes: Interactive bash as default, entrypoint script, Cursor CLI integration
- Status: Fully functional, ready for development use

---

*This file should be updated when significant changes are made to the project structure, configuration, or usage patterns.*

